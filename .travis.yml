language: bash
dist: trusty
sudo: required


###
### Attach services
###
services:
  - docker


###
### Global variables
###
env:
  matrix:
    # Test httpd
    - SERVER=httpd VERSION=apache-2.2     DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=httpd VERSION=apache-2.4     DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=httpd VERSION=nginx-stable   DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=httpd VERSION=nginx-mainline DOCKER_COMPOSE_VERSION=1.13.0
    # Test mysql
    - SERVER=mysql VERSION=mysql-5.5    DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=mysql VERSION=mysql-5.6    DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=mysql VERSION=mysql-5.7    DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=mysql VERSION=mysql-8.0    DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=mysql VERSION=mariadb-5.5  DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=mysql VERSION=mariadb-10.0 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=mysql VERSION=mariadb-10.1 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=mysql VERSION=mariadb-10.2 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=mysql VERSION=mariadb-10.3 DOCKER_COMPOSE_VERSION=1.13.0
    # Test pgsql
    - SERVER=pgsql VERSION=9.2 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=pgsql VERSION=9.3 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=pgsql VERSION=9.4 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=pgsql VERSION=9.5 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=pgsql VERSION=9.6 DOCKER_COMPOSE_VERSION=1.13.0
    # Test php
    - SERVER=php VERSION=php-fpm-5.4 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=php VERSION=php-fpm-5.5 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=php VERSION=php-fpm-5.6 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=php VERSION=php-fpm-7.0 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=php VERSION=php-fpm-7.1 DOCKER_COMPOSE_VERSION=1.13.0
    - SERVER=php VERSION=hhvm-latest DOCKER_COMPOSE_VERSION=1.13.0


###
### Berfore Install
###
before_install:
  # List info
  - whoami
  - groups
  - uname -a
  # List versions
  - docker version
  - docker-compose version
  # Get newer docker version
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-engine
  # Get newer docker-compose version
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  # List versions again
  - docker version
  - docker-compose version


before_script:

  # Disable services enabled by default
  # http://docs.travis-ci.com/user/database-setup/#MySQL
  - sudo /etc/init.d/mysql stop || true
  - sudo /etc/init.d/postgresql stop || true
  - sudo service mysql stop || true
  - sudo service postgresql stop || true


###
### Test
###
script:
  - .tests/test_single.sh . "${SERVER}" "${VERSION}"
